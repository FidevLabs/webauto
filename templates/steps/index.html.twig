
{% extends '@EasyAdmin/page/content.html.twig' %}


{% block page_title 'Demandes client' %}

{% block content_title 'Demandes client' %}


{% block main %}
    <style>
        .example-wrapper { margin: 1em auto; max-width: 800px; width: 95%; font: 18px/1.5 sans-serif; }
        .example-wrapper code { background: #F5F5F5; padding: 2px 6px; }
    </style>
    
    <div class="container">
        <div class="row">
            <table class="table datagrid"> 
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Name</th>
                        <th>Email</th>
                        <th>Etat</th>
                        <th>Fichier</th>
                        <th>Categorie</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for step in steps %}
                        <tr>
                            <td>{{ step.id }}</td>
                            <td>{{ step.name }}</td>
                            <td>{{ step.email }}</td>
                            <td>{% if step.state != null %}
                                    <span style="color:{{ step.state.color }};font-weight:bold;">{{ step.state.title }}</span>
                                {% else %}
                                    <span>Pas encore definit</span>
                                {% endif %}
                            </td>
                            <td>
                                {% for file in step.file %}
                                    <a href="{{ asset('uploads/images/docs/'~ file) }}">Document</a><br/>
                                {% endfor %}
                            </td>
                            <td>{{ step.category.name }}</td>
                            <td>
                                <button data-href="/fr/admin?routeName=app_steps" {% if step.price == null %}disabled{% endif %} type="button" class="actionSendMail btn btn-xs "
                                    data-id="{{ step.id }}" 
                                    data-email="{{ step.email }}"
                                    data-price="{{ step.price }}">
                                    <i class="fa fa-envelope"></i> Email
                                </button>
                                
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>

            </table>
        </div>
    </div>

{% endblock %}

{% block body_javascript %}
    <script type="text/javascript" src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script>    
        $(document).ready(function () {
            
            $('.actionSendMail').on('click', function () {

                var price  = $(this).data('price');
                var idStep = $(this).data('id');
                var email  = $(this).data('email');
                var href   = $(this).data('href');
               
                $.ajax({
                    url: href,
                    dataType: 'text',
                    data: 'price='+price+'&idstep='+idStep+'&email='+email,
                    success: function (response) {           
                        alert(response);
                    }
                });
                
            });
            
        });

    </script>
{% endblock %}
